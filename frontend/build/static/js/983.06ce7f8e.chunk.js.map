{"version":3,"file":"static/js/983.06ce7f8e.chunk.js","mappings":"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","sources":["utils/crypto.ts","components/SkeletonEmailList.tsx","components/SkeletonEmailContent.tsx","pages/ReadMail.tsx"],"sourcesContent":["// src/utils/crypto.ts\r\nimport CryptoJS from 'crypto-js';\r\n\r\nconst STORAGE_KEY = 'user_email_accounts';\r\nconst SECRET = 'snapmail2026'; // ควรเปลี่ยนเป็น env ใน production\r\n\r\nexport function encryptAccounts(accounts: any[]): string {\r\n  const data = JSON.stringify(accounts);\r\n  return CryptoJS.AES.encrypt(data, SECRET).toString();\r\n}\r\n\r\nexport function decryptAccounts(ciphertext: string): any[] {\r\n  try {\r\n    const bytes = CryptoJS.AES.decrypt(ciphertext, SECRET);\r\n    const decrypted = bytes.toString(CryptoJS.enc.Utf8);\r\n    return JSON.parse(decrypted);\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport function saveAccounts(accounts: any[]) {\r\n  localStorage.setItem(STORAGE_KEY, encryptAccounts(accounts));\r\n}\r\n\r\nexport function loadAccounts(): any[] {\r\n  const cipher = localStorage.getItem(STORAGE_KEY);\r\n  if (!cipher) return [];\r\n  return decryptAccounts(cipher);\r\n}\r\n","import React from 'react';\r\n\r\nconst SkeletonEmailList: React.FC<{ count?: number }> = ({ count = 6 }) => (\r\n  <div className=\"flex flex-col gap-2 animate-pulse\">\r\n    {Array.from({ length: count }).map((_, i) => (\r\n      <div key={i} className=\"flex items-center gap-3 bg-gray-100 rounded-lg h-16 p-3\">\r\n        <div className=\"w-8 h-8 rounded-full bg-gray-200\" />\r\n        <div className=\"flex-1\">\r\n          <div className=\"h-4 bg-gray-200 rounded w-1/2 mb-2\" />\r\n          <div className=\"h-3 bg-gray-200 rounded w-1/3\" />\r\n        </div>\r\n      </div>\r\n    ))}\r\n  </div>\r\n);\r\n\r\nexport default SkeletonEmailList;\r\n","import React from 'react';\r\n\r\nconst SkeletonEmailContent: React.FC = () => (\r\n  <div className=\"p-6 animate-pulse\">\r\n    <div className=\"h-6 bg-gray-200 rounded w-2/3 mb-4\" />\r\n    <div className=\"h-4 bg-gray-200 rounded w-1/3 mb-2\" />\r\n    <div className=\"h-4 bg-gray-200 rounded w-1/4 mb-6\" />\r\n    <div className=\"space-y-2\">\r\n      {Array.from({ length: 10 }).map((_, i) => (\r\n        <div key={i} className=\"h-3 bg-gray-200 rounded w-full\" />\r\n      ))}\r\n    </div>\r\n  </div>\r\n);\r\n\r\nexport default SkeletonEmailContent;\r\n","import React, { useEffect, useState, useRef, useCallback } from 'react';\r\nimport SkeletonEmailList from '../components/SkeletonEmailList';\r\nimport SkeletonEmailContent from '../components/SkeletonEmailContent';\r\n\r\ninterface Email {\r\n  subject: string;\r\n  from: string;\r\n  date: string;\r\n  snippet?: string;\r\n  body_text?: string;\r\n  body_html?: string;\r\n  headers?: Record<string, string>;\r\n  attachments?: Array<{\r\n    filename: string;\r\n    content_type: string;\r\n    size: number;\r\n    content_id?: string;\r\n    content_disposition?: string;\r\n    content?: string;\r\n  }>;\r\n}\r\n\r\nconst ReadMail: React.FC = () => {\r\n  // Multi-account selection\r\n  const [accounts, setAccounts] = useState<any[]>(() => {\r\n    try {\r\n      const { loadAccounts } = require('../utils/crypto');\r\n      return loadAccounts();\r\n    } catch {\r\n      return [];\r\n    }\r\n  });\r\n  const [selectedAccountIdx, setSelectedAccountIdx] = useState(0);\r\n  const [activeEmail, setActiveEmail] = useState<string | null>(null);\r\n  const [isDefaultEmail, setIsDefaultEmail] = useState(true);\r\n  const [emails, setEmails] = useState<Email[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [readMethod, setReadMethod] = useState<'imap' | 'graph'>('imap');\r\n  const [page, setPage] = useState(1);\r\n  const [pageSize] = useState(10);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const loaderRef = useRef<HTMLDivElement | null>(null);\r\n  const [sort, setSort] = useState<'desc' | 'asc'>('desc');\r\n  const [selectedIdx, setSelectedIdx] = useState<number | null>(null);\r\n  const [search, setSearch] = useState('');\r\n\r\n  // Filter emails by search\r\n  const filteredEmails = emails.filter((email: Email) => {\r\n    const q = search.toLowerCase();\r\n    return (\r\n      email.subject?.toLowerCase().includes(q) ||\r\n      email.from?.toLowerCase().includes(q) ||\r\n      email.body_text?.toLowerCase().includes(q)\r\n    );\r\n  });\r\n\r\n  // Infinite scroll: reset emails on filter/search/account/sort change\r\n  useEffect(() => {\r\n    setEmails([]);\r\n    setPage(1);\r\n    setHasMore(true);\r\n  }, [readMethod, pageSize, sort, accounts, selectedAccountIdx, search]);\r\n\r\n  // Fetch emails when page changes or after reset\r\n  useEffect(() => {\r\n    let ignore = false;\r\n    if (readMethod === 'graph') {\r\n      setEmails([]);\r\n      setError('ขออภัย ขณะนี้ยังไม่รองรับการอ่านอีเมลผ่าน Microsoft Graph API เนื่องจาก scope/สิทธิ์ของแอปพลิเคชันไม่ได้ตรงกับที่ Microsoft อนุญาต กรุณาใช้ IMAP/POP3 สำหรับการอ่านอีเมล');\r\n      setLoading(false);\r\n      setHasMore(false);\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    const apiUrl = process.env.REACT_APP_API_URL || 'http://localhost:8000';\r\n    const params = new URLSearchParams({\r\n      sort,\r\n      page: page.toString(),\r\n      page_size: pageSize.toString(),\r\n    });\r\n    let userCred: string | null = null;\r\n    let userEmail: string | null = null;\r\n    let isDefault: boolean = true;\r\n    if (accounts.length > 0 && accounts[selectedAccountIdx]) {\r\n      userCred = accounts[selectedAccountIdx];\r\n      if (userCred) {\r\n        const sep = userCred.includes('|') ? '|' : userCred.includes(':') ? ':' : '|';\r\n        userEmail = userCred.split(sep)[0];\r\n        isDefault = false;\r\n      } else {\r\n        userEmail = 'xvrifkhiss3889@hotmail.com';\r\n        isDefault = true;\r\n      }\r\n    } else {\r\n      userEmail = 'xvrifkhiss3889@hotmail.com';\r\n      isDefault = true;\r\n    }\r\n    setActiveEmail(userEmail);\r\n    setIsDefaultEmail(isDefault);\r\n    const cacheKey = `readmail_cache_${userEmail}_${sort}_${page}_${pageSize}_${readMethod}`;\r\n    const cache = sessionStorage.getItem(cacheKey);\r\n    if (cache) {\r\n      try {\r\n        const parsed = JSON.parse(cache);\r\n        if (!ignore) {\r\n          setEmails((prev: Email[]) => page === 1 ? (parsed.emails || []) : [...prev, ...(parsed.emails || [])]);\r\n          setError(parsed.error || null);\r\n          setHasMore(parsed.emails && parsed.emails.length === pageSize);\r\n          setLoading(false);\r\n        }\r\n        return;\r\n      } catch {}\r\n    }\r\n    const fetchEmails = async () => {\r\n      try {\r\n        let res;\r\n        if (userCred) {\r\n          res = await fetch(`${apiUrl}/read-emails?${params.toString()}`, {\r\n            method: 'POST',\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n              'Authorization': `Bearer ${process.env.REACT_APP_API_KEY}`\r\n            },\r\n            body: JSON.stringify({ credentials: userCred })\r\n          });\r\n        } else {\r\n          res = await fetch(`${apiUrl}/read-emails?${params.toString()}`, {\r\n            headers: {\r\n              'Authorization': `Bearer ${process.env.REACT_APP_API_KEY}`\r\n            }\r\n          });\r\n        }\r\n        if (res.ok) {\r\n          const data = await res.json();\r\n          if (!ignore) {\r\n            setEmails((prev: Email[]) => page === 1 ? (data.emails || []) : [...prev, ...(data.emails || [])]);\r\n            setError(null);\r\n            setHasMore(data.emails && data.emails.length === pageSize);\r\n          }\r\n          sessionStorage.setItem(cacheKey, JSON.stringify({ emails: data.emails || [] }));\r\n        } else {\r\n          const errorData = await res.json();\r\n          if (!ignore) {\r\n            setError(errorData.detail || 'Unknown error');\r\n            setHasMore(false);\r\n          }\r\n          sessionStorage.setItem(cacheKey, JSON.stringify({ emails: [], error: errorData.detail || 'Unknown error' }));\r\n        }\r\n      } catch (err) {\r\n        if (!ignore) {\r\n          if (err instanceof Error) {\r\n            setError(err.message);\r\n            setHasMore(false);\r\n            sessionStorage.setItem(cacheKey, JSON.stringify({ emails: [], error: err.message }));\r\n          } else {\r\n            setError('An unknown error occurred.');\r\n            setHasMore(false);\r\n            sessionStorage.setItem(cacheKey, JSON.stringify({ emails: [], error: 'An unknown error occurred.' }));\r\n          }\r\n        }\r\n      } finally {\r\n        if (!ignore) setLoading(false);\r\n      }\r\n    };\r\n    fetchEmails();\r\n    return () => { ignore = true; };\r\n  }, [readMethod, page, pageSize, sort, accounts, selectedAccountIdx]);\r\n\r\n  // Infinite scroll observer\r\n  const handleObserver = useCallback((entries: IntersectionObserverEntry[]) => {\r\n    const target = entries[0];\r\n    if (target.isIntersecting && hasMore && !loading) {\r\n      setPage(p => p + 1);\r\n    }\r\n  }, [hasMore, loading]);\r\n\r\n  useEffect(() => {\r\n    const option = { root: null, rootMargin: '0px', threshold: 0.1 };\r\n    const observer = new window.IntersectionObserver(handleObserver, option);\r\n    if (loaderRef.current) observer.observe(loaderRef.current);\r\n    return () => {\r\n      if (loaderRef.current) observer.unobserve(loaderRef.current);\r\n    };\r\n  }, [handleObserver]);\r\n\r\n  return (\r\n    <div className=\"flex flex-col min-h-screen bg-gray-50\">\r\n      <div className=\"max-w-4xl mx-auto w-full px-4 pt-4 pb-0\">\r\n        <div className=\"mb-2 text-xs text-gray-600 bg-gray-100 border border-gray-200 rounded px-3 py-2\">\r\n          <span className=\"font-semibold text-gray-800\">บัญชีที่ใช้ในการอ่านเมล:</span> {activeEmail} {isDefaultEmail && <span className=\"text-gray-400\">(ค่าเริ่มต้น)</span>}\r\n          {accounts.length > 1 && (\r\n            <div className=\"mt-2\">\r\n              <label className=\"mr-2 font-medium\">เลือกบัญชี:</label>\r\n              <select\r\n                className=\"border rounded px-2 py-1 text-sm\"\r\n                value={selectedAccountIdx}\r\n                onChange={(e: React.ChangeEvent<HTMLSelectElement>) => { setSelectedAccountIdx(Number(e.target.value)); setSelectedIdx(null); setPage(1); }}\r\n                title=\"เลือกบัญชีอีเมลที่ใช้ในการอ่าน\"\r\n                aria-label=\"เลือกบัญชีอีเมลที่ใช้ในการอ่าน\"\r\n              >\r\n                {accounts.map((acc, i) => {\r\n                  const sep = acc.includes('|') ? '|' : acc.includes(':') ? ':' : '|';\r\n                  const email = acc.split(sep)[0];\r\n                  return <option value={i} key={i}>{email}</option>;\r\n                })}\r\n              </select>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      <div className=\"flex-1 flex flex-col md:flex-row max-w-4xl mx-auto w-full px-4 py-6 gap-4\">\r\n        {/* Sidebar: Email List */}\r\n        <div className=\"w-full md:w-1/3 md:max-w-xs bg-white border border-gray-200 rounded-xl shadow-sm p-4 flex flex-col\">\r\n          <h2 className=\"text-lg font-bold mb-2\">กล่องอีเมล</h2>\r\n          {/* Search/filter box */}\r\n          <div className=\"mb-2\">\r\n            <input\r\n              type=\"text\"\r\n              className=\"w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400\"\r\n              placeholder=\"ค้นหาอีเมล (หัวข้อ, ผู้ส่ง, ข้อความ)\"\r\n              value={search}\r\n              onChange={e => { setSearch(e.target.value); setSelectedIdx(null); }}\r\n              aria-label=\"ค้นหาอีเมล\"\r\n            />\r\n          </div>\r\n          <div className=\"mb-2 p-2 bg-blue-50 border border-blue-200 rounded text-blue-800 text-xs\">\r\n            ระบบนี้รองรับการอ่านอีเมลผ่าน IMAP/POP3 เท่านั้น (Microsoft Graph API ยังไม่รองรับการอ่านอีเมล เนื่องจาก scope/สิทธิ์ของแอปพลิเคชันไม่ตรงกับที่ Microsoft อนุญาต)\r\n          </div>\r\n          <div className=\"mb-2 flex flex-wrap gap-2 items-center\">\r\n            <label className=\"font-medium mr-2\">เรียงลำดับ:</label>\r\n            <div className=\"relative w-48\">\r\n              <select\r\n                className=\"w-full border rounded px-3 py-2 pr-8 appearance-none focus:ring-2 focus:ring-blue-400 bg-white text-gray-700 shadow-sm hover:border-blue-400 transition\"\r\n                value={sort}\r\n                onChange={e => { setSort(e.target.value as 'desc' | 'asc'); setPage(1); }}\r\n                aria-label=\"เรียงลำดับอีเมล\"\r\n              >\r\n                <option value=\"desc\">ใหม่ → เก่า (ล่าสุดก่อน)</option>\r\n                <option value=\"asc\">เก่า → ใหม่ (เก่าสุดก่อน)</option>\r\n              </select>\r\n              <span className=\"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 flex items-center\">\r\n                <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" strokeWidth={2} viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M19 9l-7 7-7-7\" />\r\n                </svg>\r\n              </span>\r\n            </div>\r\n          </div>\r\n          {/* Infinite scroll loader */}\r\n          <div ref={loaderRef} style={{ height: 1 }} />\r\n          {loading && <div className=\"text-center text-gray-400 text-xs mt-2\">กำลังโหลดอีเมล...</div>}\r\n          {!hasMore && !loading && (\r\n            <div className=\"text-center text-gray-400 text-xs mt-2\">ไม่มีอีเมลเพิ่มเติม</div>\r\n          )}\r\n          {error && !loading && <div className=\"text-red-500 text-xs mb-2\">{error}</div>}\r\n          {loading ? (\r\n            <div className=\"flex flex-col gap-2 mt-8\">\r\n              <SkeletonEmailList count={6} />\r\n              <div className=\"text-center text-gray-400 text-xs mt-2\">กำลังโหลดอีเมล...</div>\r\n            </div>\r\n          ) : filteredEmails.length === 0 ? (\r\n            <div className=\"text-center text-gray-400 mt-8\">ไม่พบอีเมล</div>\r\n          ) : (\r\n            <div className=\"flex flex-col gap-2 overflow-y-auto max-h-[60vh]\">\r\n              {filteredEmails.map((email, idx) => (\r\n                <button\r\n                  key={idx}\r\n                  className={`text-left transition-shadow bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md p-3 flex flex-col gap-1 ${selectedIdx === idx ? 'ring-2 ring-blue-400 border-blue-300' : ''}`}\r\n                  onClick={() => setSelectedIdx(idx)}\r\n                  tabIndex={0}\r\n                  aria-label={`ดูอีเมลหัวข้อ ${email.subject || '(ไม่มีหัวเรื่อง)'}`}\r\n                >\r\n                  <div className=\"font-semibold text-base truncate text-gray-900\">{email.subject || <span className=\"italic text-gray-400\">(ไม่มีหัวเรื่อง)</span>}</div>\r\n                  <div className=\"text-xs text-gray-500 truncate\">จาก: {email.from || <span className=\"italic text-gray-400\">(ไม่ระบุ)</span>}</div>\r\n                  <div className=\"text-xs text-gray-400\">{email.date && new Date(email.date).toLocaleString('th-TH', { dateStyle: 'medium', timeStyle: 'short' })}</div>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n        {/* Main: Email Content */}\r\n        <div className=\"flex-1 bg-white border border-gray-200 rounded-xl shadow-sm p-6 ml-0 md:ml-4 min-h-[400px] flex flex-col\">\r\n          {loading ? (\r\n            <div className=\"flex-1 flex flex-col justify-center items-center\">\r\n              <div className=\"text-gray-400 text-sm mb-4\">กำลังโหลดเนื้อหาอีเมล...</div>\r\n              <SkeletonEmailContent />\r\n            </div>\r\n          ) : error ? (\r\n            <div className=\"text-red-500 text-center my-auto\">{error}</div>\r\n          ) : emails.length === 0 ? (\r\n            <div className=\"text-center text-gray-400 my-auto\">ไม่พบอีเมล</div>\r\n          ) : selectedIdx === null ? (\r\n            <div className=\"text-center text-gray-400 my-auto\">เลือกอีเมลจากรายการทางซ้ายเพื่อดูเนื้อหา</div>\r\n          ) : (\r\n            (() => {\r\n              const email = selectedIdx !== null ? emails[selectedIdx] : undefined;\r\n              if (!email) return null;\r\n              return (\r\n                <div className=\"flex flex-col gap-2\">\r\n                  <div className=\"mb-2\">\r\n                    <div className=\"text-lg font-bold text-gray-900\">{email.subject || <span className=\"italic text-gray-400\">(ไม่มีหัวเรื่อง)</span>}</div>\r\n                    <div className=\"text-xs text-gray-500\">จาก: {email.from || <span className=\"italic text-gray-400\">(ไม่ระบุ)</span>}</div>\r\n                    <div className=\"text-xs text-gray-400\">{email.date && new Date(email.date).toLocaleString('th-TH', { dateStyle: 'medium', timeStyle: 'short' })}</div>\r\n                  </div>\r\n                  <div className=\"text-sm text-gray-700 whitespace-pre-line break-words overflow-x-auto min-h-[120px]\">\r\n                    {email.body_text ? email.body_text : <span className=\"italic text-gray-400\">(ไม่มีเนื้อหา)</span>}\r\n                  </div>\r\n                  {/* Attachments */}\r\n                  {email.attachments && email.attachments.length > 0 ? (\r\n                    <div className=\"mt-4\">\r\n                      <div className=\"font-medium text-gray-700 mb-1\">ไฟล์แนบ:</div>\r\n                      <ul className=\"list-disc list-inside text-xs text-gray-600\">\r\n                        {email.attachments.map((att: any, i: number) => (\r\n                          <li key={i}>{att.filename} <span className=\"text-gray-400\">({att.size} bytes)</span></li>\r\n                        ))}\r\n                      </ul>\r\n                    </div>\r\n                  ) : null}\r\n                </div>\r\n              );\r\n            })()\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ReadMail;\r\n"],"names":["STORAGE_KEY","SECRET","encryptAccounts","accounts","data","JSON","stringify","CryptoJS","encrypt","toString","decryptAccounts","ciphertext","decrypted","decrypt","Utf8","parse","_unused","saveAccounts","localStorage","setItem","loadAccounts","cipher","getItem","_ref","count","_jsx","className","children","Array","from","length","map","_","i","_jsxs","SkeletonEmailContent","ReadMail","setAccounts","useState","require","selectedAccountIdx","setSelectedAccountIdx","activeEmail","setActiveEmail","isDefaultEmail","setIsDefaultEmail","emails","setEmails","loading","setLoading","error","setError","readMethod","setReadMethod","page","setPage","pageSize","hasMore","setHasMore","loaderRef","useRef","sort","setSort","selectedIdx","setSelectedIdx","search","setSearch","filteredEmails","filter","email","_email$subject","_email$from","_email$body_text","q","toLowerCase","subject","includes","body_text","useEffect","ignore","apiUrl","process","REACT_APP_API_URL","params","URLSearchParams","page_size","userCred","userEmail","isDefault","sep","split","cacheKey","concat","cache","sessionStorage","parsed","prev","_unused2","async","res","fetch","method","headers","body","credentials","ok","json","errorData","detail","err","Error","message","fetchEmails","handleObserver","useCallback","entries","isIntersecting","p","observer","window","IntersectionObserver","root","rootMargin","threshold","current","observe","unobserve","value","onChange","e","Number","target","title","acc","type","placeholder","fill","stroke","strokeWidth","viewBox","strokeLinecap","strokeLinejoin","d","ref","style","height","SkeletonEmailList","idx","onClick","tabIndex","date","Date","toLocaleString","dateStyle","timeStyle","undefined","attachments","att","filename","size"],"ignoreList":[],"sourceRoot":""}